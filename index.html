<!-- ==========================================
     OVERLAY SCRIPT (GAYA A)
     - Overlay MUNCUL hanya bila #overlayTrigger
       berada dalam viewport
     - Overlay HILANG apabila kawasan tidak kelihatan
     - Dua imej bergabung (PRIMARY + SECONDARY)
     - Tidak kacau layout
=========================================== -->
<script>
(function(){
  // URL Gambar overlay (gabung dua-dua)
  const IMG_PRIMARY   = "https://invitation-v2.mymawaddah.com/storage/wedapp-invitation/design/fr0042/1gAdBv175522894697110.png";
  const IMG_SECONDARY = "https://invitation-v2.mymawaddah.com/storage/wedapp-invitation/design/fr0042/T7EZA1175522895996211.png";

  const content = document.getElementById("mainCard");
  const trigger = document.getElementById("overlayTrigger");
  const firstH2 = content.querySelector("h2"); // Butiran Majlis

  if(!content || !trigger || !firstH2){
    console.warn("Overlay gagal: elemen wajib tiada.");
    return;
  }

  /* -----------------------------
     CIPTA OVERLAY DIV
  --------------------------------*/
  const overlay = document.createElement("div");
  overlay.className = "area-overlay";
  overlay.innerHTML = `
    <img src="${IMG_SECONDARY}" class="secondary" alt="">
    <img src="${IMG_PRIMARY}" class="primary" alt="">
  `;
  content.appendChild(overlay);

  /* -----------------------------
     POSISI OVERLAY DALAM KAWASAN
  --------------------------------*/
  function positionOverlay(){
    const start = trigger.offsetTop;
    const end   = firstH2.offsetTop;
    const height = Math.max(40, end - start);

    overlay.style.top = start + "px";
    overlay.style.height = height + "px";
  }

  /* Recalculate bila window resize atau content berubah */
  window.addEventListener("resize", positionOverlay);
  const mo = new MutationObserver(positionOverlay);
  mo.observe(content, { childList:true, subtree:true, attributes:true });

  positionOverlay();

  /* -----------------------------
     SHOW / HIDE overlay 
     ikut viewport
  --------------------------------*/
  if("IntersectionObserver" in window){
    const observer = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          overlay.style.display = "block";
        } else {
          overlay.style.display = "none";
        }
      });
    },{
      root: document.getElementById("appRoot"),
      threshold: 0.01,
      rootMargin: "0px 0px -40% 0px"
    });

    observer.observe(trigger);
  } else {
    overlay.style.display = "block"; // fallback
  }
})();
</script>

<!-- ==========================================
     JS LAIN FIKRI (slider, countdown, video, popup)
     *SAYA TIDAK UBAH APA-APA*
=========================================== -->

<!-- YouTube API -->
<script>
(function(){
  if(!document.getElementById('yt-iframe-api')){
    const s = document.createElement('script');
    s.id = 'yt-iframe-api';
    s.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(s);
  }
  window.onYouTubeIframeAPIReady = function(){
    try {
      window.ytPlayer = new YT.Player('ytPlayer', {
        videoId: 'JmIUdR_fob0',
        playerVars: { autoplay:1, controls:1, mute:1, rel:0, playsinline:1 },
        events:{ onReady:(e)=>{ try{e.target.playVideo();}catch(err){} } }
      });
    }catch(e){}
  };
})();
</script>

<!-- Countdown -->
<script>
(function(){
  const eventDate = new Date('2026-01-03T11:00:00+08:00');
  function pad(n){ return ("0"+n).slice(-2); }
  function update(){
    const now = new Date();
    let diff = Math.max(0, Math.floor((eventDate - now) / 1000));
    const d = Math.floor(diff/86400); diff%=86400;
    const h = Math.floor(diff/3600); diff%=3600;
    const m = Math.floor(diff/60);
    const s = diff%60;
    document.getElementById("days").textContent = d;
    document.getElementById("hours").textContent = pad(h);
    document.getElementById("mins").textContent  = pad(m);
    document.getElementById("secs").textContent  = pad(s);
  }
  update(); setInterval(update,1000);
})();
</script>

<!-- Tutup body -->
</body>
</html>
